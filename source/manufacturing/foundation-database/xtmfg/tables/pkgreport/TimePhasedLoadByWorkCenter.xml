<!DOCTYPE openRPTDef>
<report>
 <title>Time Phased Load By Work Center</title>
 <name>TimePhasedLoadByWorkCenter</name>
 <description>Shows available capacity.</description>
 <size>Letter</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>50</rightmargin>
 <leftmargin>50</leftmargin>
 <querysource>
  <name>head</name>
  <sql>SELECT &lt;? if exists("warehous_id") ?>
         ( SELECT warehous_code
             FROM whsinfo
            WHERE (warehous_id=&lt;? value("warehous_id") ?>) )
       &lt;? else ?>
         text('All Warehouses')
       &lt;? endif ?>
       AS warehouse;</sql>
 </querysource>
 <querysource>
  <name>detail</name>
  <sql>SELECT calitem_pstart as pstart, 
       calitem_pend as pend,
       (formatDate(calitem_pstart) || '-' || formatDate(calitem_pend)) AS period,
       warehous_code, wrkcnt_code AS resource,
       &lt;? value("workcenter") ?> AS resource_type,

       formatTime(xtmfg.workCenterCapacity(wrkcnt_id, calitem_id)) as f_capacity,
       xtmfg.workCenterCapacity(wrkcnt_id, calitem_id) as amt_capacity,

       formatTime(xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id)) as f_load,
       xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id) as amt_load,

       formatTime(xtmfg.workCenterCapacity(wrkcnt_id, calitem_id) -
                  xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id)) 
          as f_available,
       formatTime((xtmfg.workCenterCapacity(wrkcnt_id, calitem_id) -
                   xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id))/60) 
          as f_avl_hrs,
       (xtmfg.workCenterCapacity(wrkcnt_id, calitem_id) -
          xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id))/60 as amt_avl_hrs,
       xtmfg.workCenterCapacity(wrkcnt_id, calitem_id) -
          xtmfg.loadByWorkCenter(wrkcnt_id, calitem_id) as amt_available
     
  FROM xtmfg.wrkcnt, whsinfo,
           ( SELECT rcalitem_id as calitem_id,
                    findPeriodStart(rcalitem_id) as calitem_pstart,
                    findPeriodEnd(rcalitem_id) as calitem_pend
               FROM rcalitem
              WHERE (rcalitem_id in (
&lt;? foreach("period_id_list") ?>
  &lt;? if not isfirst("period_id_list") ?>
    ,
  &lt;? endif ?>
  &lt;? value("period_id_list") ?>
&lt;? endforeach ?>
                                    ))
             UNION
             SELECT acalitem_id as calitem_id,
                    findPeriodStart(acalitem_id) as calitem_pstart,
                    findPeriodEnd(acalitem_id) as calitem_pend
               FROM acalitem
              WHERE (acalitem_id in (
&lt;? foreach("period_id_list") ?>
  &lt;? if not isfirst("period_id_list") ?>
    ,
  &lt;? endif ?>
  &lt;? value("period_id_list") ?>
&lt;? endforeach ?>
                                    ))
           ORDER BY calitem_pstart, calitem_pend
           ) as calitem
 WHERE (warehous_id=wrkcnt_warehous_id)
&lt;? if exists("warehous_id") ?>
   AND (wrkcnt_warehous_id=&lt;? value("warehous_id") ?>)
&lt;? endif ?>


&lt;? if exists("showTooling") ?>
UNION
SELECT calitem_pstart as pstart, 
       calitem_pend as pend,
       (formatDate(calitem_pstart) || '-' || formatDate(calitem_pend)) AS period,
       warehous_code, item_number AS resource,
       &lt;? value("tooling") ?> AS resource_type,

       formatTime(xtmfg.toolCapacity(itemsite_id, calitem_id)) as f_capacity,
       xtmfg.toolCapacity(itemsite_id, calitem_id) as amt_capacity,

       formatTime(xtmfg.loadByTool(itemsite_id, calitem_id)) as f_load,
       xtmfg.loadByTool(itemsite_id, calitem_id) as amt_load,

       formatTime(xtmfg.toolCapacity(itemsite_id, calitem_id) -
                  xtmfg.loadByTool(itemsite_id, calitem_id)) 
          as f_available,
       formatTime((xtmfg.toolCapacity(itemsite_id, calitem_id) -
                   xtmfg.loadByTool(itemsite_id, calitem_id))/60) 
          as f_avl_hrs,
       (xtmfg.toolCapacity(itemsite_id, calitem_id) -
          xtmfg.loadByTool(itemsite_id, calitem_id))/60 as amt_avl_hrs,
       xtmfg.toolCapacity(itemsite_id, calitem_id) -
          xtmfg.loadByTool(itemsite_id, calitem_id) as amt_available
     
  FROM itemsite, whsinfo, item,
           ( SELECT rcalitem_id as calitem_id,
                    findPeriodStart(rcalitem_id) as calitem_pstart,
                    findPeriodEnd(rcalitem_id) as calitem_pend
               FROM rcalitem
              WHERE (rcalitem_id in (
&lt;? foreach("period_id_list") ?>
  &lt;? if not isfirst("period_id_list") ?>
    ,
  &lt;? endif ?>
  &lt;? value("period_id_list") ?>
&lt;? endforeach ?>
                                    ))
             UNION
             SELECT acalitem_id as calitem_id,
                    findPeriodStart(acalitem_id) as calitem_pstart,
                    findPeriodEnd(acalitem_id) as calitem_pend
               FROM acalitem
              WHERE (acalitem_id in (
&lt;? foreach("period_id_list") ?>
  &lt;? if not isfirst("period_id_list") ?>
    ,
  &lt;? endif ?>
  &lt;? value("period_id_list") ?>
&lt;? endforeach ?>
                                    ))
           ORDER BY calitem_pstart, calitem_pend
           ) as calitem
 WHERE (warehous_id=itemsite_warehous_id)
   AND (item_id=itemsite_item_id)
   AND (item_type='T')
&lt;? if exists("warehous_id") ?>
   AND (itemsite_warehous_id=&lt;? value("warehous_id") ?>)
&lt;? endif ?>
&lt;? if exists("item_id") ?>
   AND (itemsite_item_id=&lt;? value("item_id") ?>)
&lt;? endif ?>
&lt;? endif ?>
ORDER BY pstart, resource
;
</sql>
 </querysource>
 <colordef>
  <name>5863166</name>
  <red>58</red>
  <green>63</green>
  <blue>166</blue>
 </colordef>
 <rpthead>
  <height>99</height>
  <label>
   <rect>
    <x>89</x>
    <y>10</y>
    <width>634</width>
    <height>37</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>18</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Time Phased Available Capacity By Work Center</string>
  </label>
  <label>
   <rect>
    <x>355</x>
    <y>75</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Capacity</string>
  </label>
  <label>
   <rect>
    <x>0</x>
    <y>75</y>
    <width>74</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Period</string>
  </label>
  <field>
   <rect>
    <x>144</x>
    <y>50</y>
    <width>200</width>
    <height>19</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>warehouse</column>
   </data>
  </field>
  <label>
   <rect>
    <x>30</x>
    <y>50</y>
    <width>105</width>
    <height>19</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Warehouse:</string>
  </label>
  <label>
   <rect>
    <x>463</x>
    <y>75</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Load</string>
  </label>
  <label>
   <rect>
    <x>169</x>
    <y>75</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Resource</string>
  </label>
  <label>
   <rect>
    <x>555</x>
    <y>75</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Available</string>
  </label>
  <line>
   <xstart>0</xstart>
   <ystart>89</ystart>
   <xend>750</xend>
   <yend>89</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>655</x>
    <y>75</y>
    <width>89</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Available (Hours)</string>
  </label>
  <label>
   <rect>
    <x>355</x>
    <y>60</y>
    <width>239</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <top/>
   <string>------------------------------- Minutes ------------------------------</string>
  </label>
 </rpthead>
 <pghead>
  <firstpage/>
  <height>13</height>
 </pghead>
 <pghead>
  <height>29</height>
  <label>
   <rect>
    <x>360</x>
    <y>0</y>
    <width>244</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <top/>
   <string>------------------------------- Minutes ------------------------------</string>
  </label>
  <label>
   <rect>
    <x>0</x>
    <y>10</y>
    <width>86</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Period</string>
  </label>
  <label>
   <rect>
    <x>360</x>
    <y>10</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Capacity</string>
  </label>
  <label>
   <rect>
    <x>660</x>
    <y>10</y>
    <width>89</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Available (Hours)</string>
  </label>
  <line>
   <xstart>0</xstart>
   <ystart>25</ystart>
   <xend>750</xend>
   <yend>25</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>469</x>
    <y>10</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Load</string>
  </label>
  <label>
   <rect>
    <x>560</x>
    <y>10</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Available</string>
  </label>
  <label>
   <rect>
    <x>175</x>
    <y>8</y>
    <width>80</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Resource</string>
  </label>
 </pghead>
 <section>
  <name>detail</name>
  <group>
   <name>detail</name>
   <column>pstart</column>
   <head>
    <height>24</height>
    <field>
     <rect>
      <x>0</x>
      <y>5</y>
      <width>250</width>
      <height>14</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>period</column>
     </data>
    </field>
   </head>
   <foot>
    <height>14</height>
   </foot>
  </group>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>23</height>
   <field>
    <rect>
     <x>360</x>
     <y>0</y>
     <width>80</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_capacity</column>
    </data>
   </field>
   <field>
    <rect>
     <x>469</x>
     <y>0</y>
     <width>80</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_load</column>
    </data>
   </field>
   <field>
    <rect>
     <x>664</x>
     <y>0</y>
     <width>80</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_avl_hrs</column>
    </data>
   </field>
   <field>
    <rect>
     <x>560</x>
     <y>0</y>
     <width>80</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <hcenter/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_available</column>
    </data>
   </field>
   <field>
    <rect>
     <x>175</x>
     <y>0</y>
     <width>175</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>resource</column>
    </data>
   </field>
   <field>
    <rect>
     <x>69</x>
     <y>2</y>
     <width>94</width>
     <height>14</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>resource_type</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>22</height>
  <label>
   <rect>
    <x>0</x>
    <y>0</y>
    <width>69</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <field>
   <rect>
    <x>80</x>
    <y>0</y>
    <width>100</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
  <field>
   <rect>
    <x>689</x>
    <y>0</y>
    <width>51</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
  <label>
   <rect>
    <x>600</x>
    <y>0</y>
    <width>85</width>
    <height>14</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
 </pgfoot>
</report>
