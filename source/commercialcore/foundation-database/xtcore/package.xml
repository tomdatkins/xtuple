<package id="xtcore"
         name="xtcore"
         developer="xTuple"
         descrip="xTuple Commercial Core package."
         version="4.10.0Beta"
         updater="2.2.2">
  <pkgnotes> This package creates the required database tables and functions for xTuple Commercial Core. </pkgnotes>

  <prerequisite type="license">
    <message>
      This file is part of the xTuple Commercial Core Package for xTuple ERP, and is Copyright (c) 1999-2015 by OpenMFG LLC, d/b/a xTuple.  It is licensed to you under the xTuple End-User License Agreement ("the EULA"), the full text of which is available at www.xtuple.com/EULA.  While the EULA gives you access to source code and encourages your involvement in the development process, this Package is not free software.  By using this software, you agree to be bound by the terms of the EULA.
    </message>
  </prerequisite>

  <prerequisite type="Query" name="Checking for db version">
    <query>SELECT compareVersion(fetchMetricText('ServerVersion'), '4.9.0') >= 0;</query>
    <message>This version of xTuple Commercial Core is compatible with xTuple ERP 4.9.x and later.</message>
  </prerequisite>

  <prerequisite type="query" name="Looking for plv8">
    <query>select exists (select 1 from pg_extension where extname = 'plv8');</query>
    <message>The database extension PLv8 must be installed before you can install the xTuple Commercial Core.</message>
  </prerequisite>

  <prerequisite type="Query" name="Checking for prior installation">
    <query>SELECT COUNT(*)=0 FROM pkghead WHERE pkghead_name = 'xtcore';</query>
    <message>The xTuple Commercial Core extension package is already installed in this database. Either remove the installed package and try again or use an upgrade script instead of a fresh installation script.</message>
  </prerequisite>

  <script file="tables/emlprofile.sql"                            name="emlprofile" />

  <script file="tables/poemlprofile.sql"                          name="poemlprofile" />
  <script file="tables/potype.sql"                                name="potype" />
  <script file="tables/poheadext.sql"                             name="poheadext" />
  <script file="tables/vendinfoext.sql"                           name="vendinfoext" />

  <createfunction file="functions/deleteunusedpotypes.sql"        name="deleteunusedpotypes" />

  <loadappscript file="tables/pkgscript/initMenu.js"              name="initMenu">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/ParameterGroupUtils.js"   name="ParameterGroupUtils">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/poType.js"                name="poType">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/poTypes.js"               name="poTypes">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/purchaseOrder.js"         name="purchaseOrder">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/setup.js"                 name="setup">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/vendor.js"                name="vendor">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/xtCore.js"                name="xtCore">xTuple Core</loadappscript>
  <loadappscript file="tables/pkgscript/xtCoreErrors.js"          name="xtCoreErrors">xTuple Core</loadappscript>

  <loadappui file="tables/pkguiform/poType.ui">xTuple Core</loadappui>
  <loadappui file="tables/pkguiform/poTypes.ui">xTuple Core</loadappui>

  <loadmetasql file="tables/pkgmetasql/poheadext-table.mql">xTuple Core</loadmetasql>
  <loadmetasql file="tables/pkgmetasql/potype-table.mql">xTuple Core</loadmetasql>
  <loadmetasql file="tables/pkgmetasql/vendinfoext-table.mql">xTuple Core</loadmetasql>

  <loadreport file="tables/pkgreport/PurchaseOrderTypes.xml">xtcore package</loadreport>

</package>
